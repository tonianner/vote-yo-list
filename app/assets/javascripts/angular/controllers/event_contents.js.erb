app.controller("EventCtrl", DashBoardCtrl)

DashBoardCtrl.$inject = ['ToDoFactory', 'EventFactory', '$scope', '$stateParams']

function DashBoardCtrl(ToDoFactory, EventFactory, $scope, $stateParams) {

  // EVENTS //
  var EventList = EventFactory;

  // New Event
  $scope.newEvent = {};

  $scope.selectedEvent = {};

  // Index
  $scope.allEvents = EventList.query();


  // Create event
  $scope.addEvent = function() {
    EventList.save($scope.newEvent, function(newEvent) {
      $scope.allEvents.push(newEvent);
      $scope.newEvent = {}
    });
  };

  // Update event >> Working but need to refresh for event list
  $scope.updateEvent = function(data) {
    $scope.selectedEvent.title = data
    $scope.selectedEvent.$update({id: $scope.selectedEvent.id})
  }

  // Delete
  $scope.deleteEvent= function(event) {
    EventList.delete({id: event.id});
    var index = $scope.allEvents.indexOf(event);
    $scope.allEvents.splice(index, 1);
  }


  // Show one event and show todo tasks in the event
  $scope.selectEvent = function(id) {
    $scope.selectedEvent = EventList.get({id: id})

    $scope.eventId = id

    var TaskLists = ToDoFactory

    // Show TASKS in selected event
    $scope.allTasks = TaskLists.query({eventId: $scope.eventId})

    // Delete Task
    $scope.deleteTask= function(id) {
      TaskLists.delete({eventId: $scope.eventId, id: id});
      var index = $scope.allTasks.indexOf(event);
      $scope.allTasks.splice(index, 1);
    }
  };
}
