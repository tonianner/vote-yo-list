// directive >> event_list.js.erb
// _angular_confit.js.erb >> .state >> url: '/events/:id'

app.controller("EventCtrl", DashBoardCtrl)

DashBoardCtrl.$inject = ['EventFactory', '$scope', '$stateParams', '_']

function DashBoardCtrl(EventFactory, $scope, $stateParams, _) {
  console.log('Dash Board Ctrl')

  // EVENTS //
  var EventList = EventFactory;

  // Index >> Get All
  $scope.allEvents = EventList.query();

  // Blank new Event for Form >> Create Event
  $scope.newEvent = {};

  // Show selected content
  $scope.selectedEvent = EventList.get({id: $stateParams.id})

  // Create event
  $scope.addEvent = function() {
    EventList.save($scope.newEvent, function(newEvent) {
      $scope.allEvents.push(newEvent);
      $scope.newEvent = {}
    });
  };

  // Update event
  $scope.updateEvent = function(data, eventId) {

    // To update the Event List after saving it >> $scope.allEvents[0].title = data;
    angular.forEach($scope.allEvents, function(value, key){
      if (eventId === value.id) {
        value.title = data
      }
    })

    // To update the selected event with the new data
    $scope.selectedEvent.title = data;
    $scope.selectedEvent.$update({id: $stateParams.id})
  }

  $scope.updateEventDate = function(data) {
    $scope.selectedEvent.$update({id: $stateParams.id})
  }

  // Delete
  $scope.deleteEvent= function(event) {
    EventList.delete({id: event.id});
    var index = $scope.allEvents.indexOf(event);
    $scope.allEvents.splice(index, 1);
  }

}
