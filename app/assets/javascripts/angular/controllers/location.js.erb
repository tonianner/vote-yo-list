app.controller('locationCtrl',locationCtrl)

locationCtrl.$inject = ['LocationFactory', '$scope', '$stateParams']

function locationCtrl(LocationFactory, $scope, $stateParams) {
  console.log('Location Controller')

  var LocationList = LocationFactory

  $scope.allLocations = LocationList.query({eventId: $stateParams.id})

  $scope.newPlace = {};

  // Create Location
  $scope.addLocation = function() {
    LocationList.save({eventId: $stateParams.id}, $scope.newPlace, function(newPlace) {
      $scope.allLocations.push(newPlace);
      $scope.newPlace = {}
    });
  };

  // Delete Task
  $scope.deleteLocation= function(id) {
    LocationList.delete({eventId: $stateParams.id, id: id});
    var index = $scope.allLocations.indexOf(id);
    $scope.allLocations.splice(index, 1);
  }

  // $scope.result = []
  // $scope.highestVotes = function(){
  //   angular.forEach($scope.allLocations, function(value, key) {
  //     $scope.result.push(value.votes)
  //   })
  //   return $scope.result
  // }

  // $scope.max = function () {
  //   // $scope.allLocations.reduce(function(prev, current){
  //   //   return (prev > current) ? prev : current
  //   // })
  //   angular.forEach($scope.allLocations, function(value, key){
  //     value.reduce(function(prev,current){
  //       return (prev.votes > current.votes) ? prev : current
  //     })
  //   })
  // }

  $scope.upVote = function (place) {
    $scope.selectedVote = LocationList.get({eventId: $stateParams.id, id: place.id})

    if ($scope.selectedVote.votes == null) {
      $scope.selectedVote.votes = 0
    }

    $scope.selectedVote.votes = place.votes++
    $scope.selectedVote.votes++

    $scope.selectedVote.$update({eventId: $stateParams.id, id: place.id})

  }

  $scope.downVote = function (place) {
    $scope.selectedVote = LocationList.get({eventId: $stateParams.id, id: place.id})

    if ($scope.selectedVote.votes == null) {
      $scope.selectedVote.votes = 0
    }

    $scope.selectedVote.votes = place.votes--
    $scope.selectedVote.votes--

    $scope.selectedVote.$update({eventId: $stateParams.id, id: place.id})
  }


}